---
title: "Modeling loan interest rates"
---

# Introduction

## Goal

Practice modeling with multiple predictors using the data on loan interest rates.

## Packages

The dataset is about loans from the peer-to-peer lender, Lending Club, from the **openintro** package.
We will use **tidyverse** and **tidymodels** for data exploration and modeling, respectively.

```{r}
#| label: load-packages
#| message: false
library(tidyverse)
library(tidymodels)
library(openintro)
```

## Data prep

Before we use the dataset, we'll make a few transformations to it.

-   Review the code below with your neighbor and write a summary of the data transformation pipeline.

Add response here.

```{r}
#| label: data-prep
loans <- loans_full_schema |>
  mutate(
    credit_util = total_credit_utilized / total_credit_limit,
    bankruptcy = as.factor(if_else(public_record_bankrupt == 0, 0, 1)),
    verified_income = droplevels(verified_income),
    homeownership = str_to_title(homeownership),
    homeownership = fct_relevel(homeownership, "Rent", "Mortgage", "Own")
  ) |>
  rename(credit_checks = inquiries_last_12m) |>
  select(
    interest_rate, loan_amount, verified_income, 
    debt_to_income, credit_util, bankruptcy, term, 
    credit_checks, issue_month, homeownership
  )
```

Here is a glimpse at the data:

```{r}
#| label: glimpse-loans
glimpse(loans)
```

# Analysis

## Get to know the data

-   What is a typical interest rate in this dataset? What are some attributes of a typical loan and a typical borrower. Give yourself no more than 5 minutes for this exploration and share 1-2 findings.

```{r}
#| label: explore-loans
# add code here
```

```{r}
#| label: explore-borrowers
# add code here
```

## Interest rate vs. credit utilization

-   For a regression model for predicting interest rate from credit utilization. Display the summary output.

```{r}
#| label: rate-util-fit
# add code here
```

-   Visualize the model.

```{r}
#| label: rate-util-plot
# add code here
```

-   Interpret the intercept and the slope.

Intercept: Add response here.

Slope: Add response here.

## Interest rate vs. homeownership

-   Fit a regression model for predicting interest rate from homeownership and display the summary output.

```{r}
#| label: rate-home-fit
# add code here
```

-   Interpret each coefficient in context of the problem.

    -   Intercept: Add response here.

    -   Slopes:

        -   Add response here.

        -   Add response here.

## Interest rate vs. credit utilization and homeownership

### Main effects model

-   Fit a regression model to predict interest rate from credit utilization and homeownership, **without** an interaction effect between the two predictors. Display the summary output.

```{r}
#| label: rate-util-home-fit
# add code here
```

-   Write the estimated regression equation for loan applications from each of the homeownership groups separately.
    -   Rent: $add~math~text~here$
    -   Mortgage: $add~math~text~here$
    -   Own: $add~math~text~here$
-   How does the model predict the interest rate to vary as credit utilization varies for loan applicants with different homeownership status. Are the rates the same or different?

Add response here.

### Interaction effects model

-   Fit a regression model to predict interest rate from credit utilization and homeownership, **with** an interaction effect between the two predictors. Display the summary output.

```{r}
#| label: rate-util-home-int-fit
# add code here
```

-   Write the estimated regression equation for loan applications from each of the homeownership groups separately.
    -   Rent: $add~math~text~here$
    -   Mortgage: $add~math~text~here$
    -   Own: $add~math~text~here$
-   How does the model predict the interest rate to vary as credit utilization varies for loan applicants with different homeownership status. Are the rates the same or different?

Add response here.

### Choosing a model

Rule of thumb: **Occam's Razor** - Don't over-complicate the situation!
We prefer the *simplest* best model.

-   Display model level summary statistics.

```{r}
#| label: glance
# add code here
```

-   What is R-squared? What is adjusted R-squared?

Add response here.

-   Based on the adjusted $R^2$s of these two models, which one do we prefer?

Add response here.

## Another model to consider

-   Let's add one more model to the variable -- issue month. Should we add this variable to the interaction effects model from earlier?

```{r}
#| label: new-fit
# add code here
```

Add response here.
