---
title: "Building a spam filter"
---

In this code along, we will

-   Fit a logistic regression model in R for a binary response variable
-   Use a logistic regression model for classification

To illustrate logistic regression, we will build a spam filter from email data.

The data come from incoming emails in David Diez's (one of the authors of OpenIntro textbooks) Gmail account for the first three months of 2012.
All personally identifiable information has been removed.

```{r}
#| label: load-packages
#| message: false
library(tidyverse)
library(tidymodels)
library(openintro)
```

```{r}
#| label: glimpse-email
glimpse(email)
```

The variables we'll use in this analysis are

-   `spam`: 1 if the email is spam, 0 otherwise
-   `exclaim_mess`: The number of exclamation points in the email message

**Goal:** Use the number of exclamation points in an email to predict whether or not it is spam.

# Exploratory data analysis

Let's start by taking a look at our data.
Create an density plot to investigate the relationship between `spam` and `exclaim_mess`.
Additionally, calculate the mean number of exclamation points for both spam and non-spam emails.

```{r}
# add code here
```

# Linear model -- a false start

Suppose we try using a linear model to describe the relationship between the number of exclamation points and whether an email is spam.

## Fit

Fit a linear regression model to whether an email is spam from the number of exclamation points in the email.

```{r}
#| label: lm-fit
# add code here
```

## Visualize

Visualizate the linear model.

```{r}
#| label: lm-viz
# add code here
```

-   Is the linear model a good fit for the data? Why or why not?

Add response here.

# Logistic regression -- a different approach

Let $p$ be the probability an email is spam (success).

-   $\frac{p}{1-p}$: odds an email is spam (if p = 0.7, then the odds are 0.7/(1 - 0.7) = 2.33)
-   $\log\Big(\frac{p}{1-p}\Big)$: "log-odds", i.e., the natural log, an email is spam

The logistic regression model using the number of exclamation points as an explanatory variable is as follows:

$$\log\Big(\frac{p}{1-p}\Big) = \beta_0 + \beta_1 \times exclaim\_mess$$

The probability an email is spam can be calculated as:

$$p = \frac{\exp\{\beta_0 + \beta_1 \times exclaim\_mess\}}{1 + \exp\{\beta_0 + \beta_1 \times exclaim\_mess\}}$$

# Model 1: One predictor

## Fit

Fit a logistic regression model to predict the probability an email is spam from the number of exclamation points in the email.

```{r}
#| label: log-fit
# add code here
```

## Summarize

Write the estimated model.

$$\log\Big(\frac{p}{1-p}\Big) = -2.27 - 0.000272 \times exclaim\_mess$$

# Predict

What is the probability the email is spam if it contains 10 exclamation points?
Answer the question using the `predict()` function.

```{r}
#| label: log-pred
# add code here
```

# Classify

We have the probability an email is spam, but ultimately we want to use the probability to classify an email as spam or not spam.
Therefore, we need to set a **decision-making threshold**, such that an email is classified as spam if the predicted probability is greater than the threshold and not spam otherwise.

## Think

Suppose you are a data scientist working on a spam filter.
You must determine how high the predicted probability must be before you think it would be reasonable to call it spam and put it in the junk folder (which the user is unlikely to check).
What are some trade offs you would consider as you set the decision-making threshold?

Add response here.

## Do

Classify the emails in this dataset as spam or not spam.

```{r}
#| label: log-aug
# add code here
```

# Model 2: All predictors

Fit a model with **all** variables in the dataset as predictors and receate the visualization above for this model.

```{r}
#| label: log2
# add code here
```